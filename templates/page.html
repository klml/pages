{{>header}}

  <h1><a href="{{path}}">{{title}}</a></h1>
  <img src="../images/fusszettel.png" />
  <input name="id" value="{{id}}" readonly="readonly" onFocus="this.select()" /> 
  <div id="tools" class="both"></div>

  <div id="wiki">
{{#isticket}}
 <form class="keyline" id="keyline" onclick='keyliner()' ><!-- use form is easier than in-place-editor ? exept: copy -->
 {{>keyline}}
 </form>
{{/isticket}}
   
   <div class="wiki both">{{{body}}}</div>
  <p class="pagetools">
   <a href="#/edit">Edit this page</a>
   <!--a href="#/history" class="wiki">History</a>
   <a href="#/upload">Upload File</a -->
  </p>

   
  </div>
  <p class="editinfo">von {{#edit_by}} {{name}} {{/edit_by}} um <span class="date">{{edit_at}}</span></p>      

    <div id="ticketer" class="hottyper both" ><button>New followUP</button></div>

    <ul>
     {{#comments}}
     <li>{{comment}}</li>
    {{/comments}}  
    </ul>



    {{#has_atts}}
    <div id="comments">
      <ul>
        {{#atts}}
          <dt><a href="{{uri}}">{{name}}</a> ({{type}})</li>
        {{/atts}}
      </ul>
    </div>
   {{/has_atts}}
   
   
    {{#has_atts}}
    <div id="files">
      <p>Files attached to <em>{{title}}</em>:</p>
      <ul>
        {{#atts}}
          <dt><a href="{{uri}}">{{name}}</a> ({{type}})</li>
        {{/atts}}
      </ul>
    </div>
   {{/has_atts}}

 </body>
 <script src="../script/myloader.js"></script>
 <script src="/_utils/script/base64.js"></script>
 <script src="/_utils/script/jquery.form.js"></script>
 <script src="../script/wicketboard.js"></script>
 <script src="../script/wicketpresets.js"></script>
 <script src="../script/form2object.js"></script><!-- http://code.google.com/p/form2js/ -->
 
 <script type="text/javascript" charset="utf-8">
    opts.ddoc = {{{ddoc}}};
    $.couch.app(function(app) {
      $("#wiki").evently("wiki", app);
      
      $("#tools").evently("tools", app);

      $$("#wiki").docid = {{docid}};
      $$("#wiki").title = {{title_json}};
      $$("#wiki").rev = "{{rev}}";
      //for keyline
      $$("#wiki").type = "{{{type}}}";
      $$("#wiki").prio = "{{{prio}}}";
      $$("#wiki").state = "{{state}}"; 
      $$("#wiki").punct = "{{{punct}}}";
      $$("#wiki").queue = "{{{queue}}}";
      $$("#wiki").user = "{{{user}}}";
      $$("#wiki").ddate = "{{{ddate}}}";

      $.pathbinder.begin("{{begin}}");
    }, opts);

function safekeyline() { // cant wicketboard.js: msg
    var formData = form2object('keyline');
    var formkeyline = JSON.stringify(formData, null, '\t');
    $.ajax({
        type: "PUT",
        url: "../../../../{{id}}" , //< TODO
        data: formkeyline ,
        success: function(msg){
            var msgJSON = eval('(' + msg + ')');
            $("input[name='_rev']").val(msgJSON.rev);
            $("input").attr('readonly','readonly');
            $("form.keyline .submit").hide('slow');
            // TODO if not logged in
        }
    });
    safetime = 5 ;
    };
 
 </script>
<!--// http://agaoglu.tumblr.com/post/1231059494/serialize-form-data-to-json-with-jquery -->
</html>
